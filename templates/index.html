{% extends 'base.html' %}{% load static %}
{% block main %}
    <!-- Hero section -->
    <section class="hero-section">
        <div class="hero-slider owl-carousel">
            <div class="hs-item set-bg" data-setbg="{% static 'img/bg.jpg' %}">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-6 col-lg-7 text-white">
                            <span>Tudo em</span>
                            <h2>capas</h2>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                                ut labore et dolore magna aliqua. Quis ipsum sus-pendisse ultrices gravida. Risus
                                commodo viverra maecenas accumsan lacus vel facilisis. </p>
                            <a href="#" class="site-btn sb-line">CATEGORIAS</a>
                            <a href="#" class="site-btn sb-white">PROMOÇÕES</a>
                        </div>
                    </div>
                    <div class="offer-card text-white">
                        <span>a partir de</span>
                        <h2>R$9,00</h2>
                    </div>
                </div>
            </div>
            <div class="hs-item set-bg" data-setbg="{% static 'img/bg-2.jpeg' %}">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-6 col-lg-7 text-white">
                            <span>vários</span>
                            <h2>acessórios</h2>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                                ut labore et dolore magna aliqua. Quis ipsum sus-pendisse ultrices gravida. Risus
                                commodo viverra maecenas accumsan lacus vel facilisis. </p>
                            <a href="#" class="site-btn sb-line">CATEGORIAS</a>
                            <a href="#" class="site-btn sb-white">PROMOÇÕES</a>
                        </div>
                    </div>
                    <div class="offer-card text-white">
                        <span>a partir de</span>
                        <h2>R$29,00</h2>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="slide-num-holder" id="snh-1"></div>
        </div>
    </section>
    <!-- Hero section end -->

    <!-- Features section -->
    <section class="features-section">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4 p-0 feature">
                    <div class="feature-inner">
                        <div class="feature-icon">
                            <img src="{% static 'img/icons/1.png' %}" alt="#">
                        </div>
                        <h2>Várias formas de pagamento</h2>
                    </div>
                </div>
                <div class="col-md-4 p-0 feature">
                    <div class="feature-inner">
                        <div class="feature-icon">
                            <img src="{% static 'img/icons/2.png' %}" alt="#">
                        </div>
                        <h2>Produtos de qualidade</h2>
                    </div>
                </div>
                <div class="col-md-4 p-0 feature">
                    <div class="feature-inner">
                        <div class="feature-icon">
                            <img src="{% static 'img/icons/3.png' %}" alt="#">
                        </div>
                        <h2>Entrega rápida</h2>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Features section end -->

    <!-- latest product section -->
    <section class="top-letest-product-section">
        <div class="container">
            <div class="section-title">
                <h2>NOVIDADES</h2>
            </div>
            <div class="product-slider owl-carousel">
                {% for p in latest_products %}
                    <div class="product-item">
                        <div class="pi-pic">
                            <a href="{% url 'product_detail' slug=p.slug pk=p.id %}"><img class="product-img"
                                                                                          src="{{ p.image.url }}"
                                                                                          alt="{{ p.slug }}-{{ forloop.counter0 }}"></a>
                            <div class="pi-links">
                                <a href="#" class="add-card"><i
                                        class="flaticon-bag"></i><span>ADICIONAR AO CARRINHO</span></a>
                                <a href="#" class="wishlist-btn"><i class="flaticon-heart"></i></a>
                            </div>
                        </div>
                        <div class="pi-text">
                            {% if p.promocao %}
                                <h6>R${{ p.promocao }}</h6>
                            {% else %}
                                <h6>R${{ p.preco }}</h6>
                            {% endif %}
                            <a href="{% url 'product_detail' slug=p.slug pk=p.id %}"><p>{{ p.titulo }}</p></a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
    <!-- latest product section end -->

    <!-- Product filter section -->
    <section class="product-filter-section">
        <div class="container">
            <div class="section-title">
                <h2>MAIS VENDIDOS</h2>
            </div>
            <ul class="product-filter-menu">
                {% for c in categorias_p %}
                    <li><a href="#">{{ c.titulo }}</a></li>
                {% endfor %}
            </ul>

            <div class="row" id="productlist" href="{% url 'load-products' %}"></div>

            <div class="text-center pt-5">
                <button class="site-btn sb-line sb-dark" id="loadMore">CARREGAR MAIS</button>
            </div>
    </section>
    <!-- Product filter section end -->

    <!-- Banner section -->
    <section class="banner-section">
        <div class="container">
            <div class="banner set-bg" data-setbg="{% static 'img/banner-bg.jpeg' %}">
                <div class="tag-new">NOVO</div>
                <span>várias</span>
                <h2>Capas</h2>
                <a href="#" class="site-btn">COMPRE JÁ</a>
            </div>
        </div>
    </section>
    <!-- Banner section end  -->

{% endblock %}

{% block js %}
    <script>
        jQuery(document).ready(function ($) {
            $(function () {
                $("#loadMore").on('click', function (e) {
                    e.preventDefault();
                    load_more_products();
                    if (nomore) {
                        $(this).hide();
                    }
                });
            });

            get_products();

            let n_pages = 0;

            function get_products() {
                let div = $('#productlist');
                $.ajax({
                    type: "GET",
                    url: div.attr('href'),
                    success: function (data) {
                        div.append(data);
                        n_pages = $('#pages').val();
                        if (!n_pages) {
                            $("#loadMore").hide();
                        }
                    },
                    error: function () {
                        console.log('Something went wrong...');
                    }
                });
                return false;
            }

            let next = 1;
            let nomore = false;

            function load_more_products() {
                let div = $('#productlist');
                if (next < n_pages) {
                    next++;
                }
                if (next == n_pages) {
                    nomore = true
                }
                $.ajax({
                    url: div.attr('href'),
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        n_page: next
                    },
                    success: function (data, status, msg) {
                        $(data).each(function (i, v) {
                            div.append('<div class="col-lg-3 col-sm-6"><div class="product-item"><div class="pi-pic"><div class="tag-sale">ESTOQUE</div><a href="produtos/' + v.slug + '/' + v.id + '"><img class="product-img" src="' + v.image_url + '"alt="' + v.slug + '"></a><div class="pi-links"><a href="#" class="add-card mr-1"><i class="flaticon-bag"></i><span>ADICIONAR AO CARRINHO</span></a><a href="#" class="wishlist-btn"><i class="flaticon-heart"></i></a></div></div><div class="pi-text"><h6 class="promocao">R$' + v.promocao + '</h6><h6 class="preco">R$' + v.preco + '</h6><a href="produtos/' + v.slug + '/' + v.id + '"><p>' + v.titulo + '</p></a></div></div></div>');
                            if (v.estoque) {
                                $('.tag-sale:last').show();
                            } else {
                                $('.tag-sale:last').hide();
                            }

                            if (v.promocao) {
                                $('.preco:last').hide();
                            } else {
                                $('.promocao:last').hide();
                            }
                        })
                    },
                    error: function (data, status, error) {
                        alert('Erro, animal.');
                    }
                });
            }
        });
    </script>
{% endblock %}